<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDBX Diff Analyzer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header-container">
        <h1>KDBX Diff Analyzer</h1>
        <button id="reconnectBtn" class="reconnect-btn" style="display:none" title="Reconnect to server">‚ü≥ Reconnect</button>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" data-tab="tab-compare">Compare</button>
        <button class="tab-btn" data-tab="tab-transfer" data-requires-upload disabled>Transfer</button>
        <button class="tab-btn" data-tab="tab-duplicates" data-requires-upload disabled>Duplicates</button>
        <button class="tab-btn" data-tab="tab-import" data-requires-upload disabled>Import</button>
        <button class="tab-btn" data-tab="tab-search" data-requires-upload disabled>Search</button>
        <button class="tab-btn" data-tab="tab-csv-import">CSV Import</button>
    </nav>

    <div id="status" class="status"></div>

    <!-- Compare Tab -->
    <div id="tab-compare" class="tab-panel active">
        <div id="dbHistorySection" class="db-history-section" style="display:none">
            <h3 class="db-history-title">Recent Databases</h3>
            <div id="dbHistoryList" class="db-history-list"></div>
        </div>
        <div class="upload-form">
            <div class="form-row">
                <fieldset>
                    <legend>Database 1</legend>
                    <label>File: <input type="file" id="db1"></label>
                    <span id="stagedDb1" class="staged-indicator" style="display:none"></span>
                    <label>Password: <input type="password" id="passwordDb1"></label>
                    <label>Key File: <input type="file" id="keyFile1"></label>
                    <span id="stagedKey1" class="staged-indicator" style="display:none"></span>
                </fieldset>
                <fieldset>
                    <legend>Database 2</legend>
                    <label>File: <input type="file" id="db2"></label>
                    <span id="stagedDb2" class="staged-indicator" style="display:none"></span>
                    <label>Password: <input type="password" id="passwordDb2"></label>
                    <label>Key File: <input type="file" id="keyFile2"></label>
                    <span id="stagedKey2" class="staged-indicator" style="display:none"></span>
                </fieldset>
            </div>
            <div class="button-row">
                <button id="uploadBtn">Open &amp; Compare</button>
                <button id="compareBtn" disabled>Compare</button>
            </div>
            <div id="downloadSection" class="button-row" style="display:none">
                <button id="downloadDb1Btn" class="btn-secondary">Download DB1</button>
                <button id="downloadDb2Btn" class="btn-secondary">Download DB2</button>
            </div>
        </div>
        <div id="compareResults"></div>
    </div>

    <!-- Transfer Tab -->
    <div id="tab-transfer" class="tab-panel">
        <div id="transferContent">
            <p class="placeholder">Run a comparison first on the Compare tab, then return here to transfer entries.</p>
        </div>
    </div>

    <!-- Duplicates Tab -->
    <div id="tab-duplicates" class="tab-panel">
        <div class="button-row">
            <select id="dupCriteria">
                <option value="username+url">Username + URL</option>
                <option value="title+username">Title + Username</option>
            </select>
            <button id="findDuplicatesBtn">Find Duplicates</button>
            <button id="removeDuplicatesBtn" class="btn-secondary" disabled>Remove Selected</button>
            <button class="btn-secondary" onclick="Transfer.downloadDb('db1')">Download Cleaned DB1</button>
        </div>
        <div id="dupResults"></div>
    </div>

    <!-- Import Tab -->
    <div id="tab-import" class="tab-panel">
        <p class="import-direction">Import entries from <strong>DB2</strong> into <strong>DB1</strong></p>
        <div class="button-row">
            <button id="importNewBtn">Import New Only</button>
            <button id="showSelectBtn" class="btn-secondary">Select &amp; Import</button>
            <button id="importAllBtn" class="btn-secondary">Import All</button>
            <button id="importSelectedBtn" disabled>Import Selected</button>
            <button class="btn-secondary" onclick="Transfer.downloadDb('db1')">Download Updated DB1</button>
            <div class="split-btn-group">
                <button id="extractBtn" class="btn-secondary split-btn-main">Extract Titles &amp; URLs</button><button id="extractDropdownBtn" class="btn-secondary split-btn-arrow">&#9662;</button>
                <div id="extractMenu" class="split-btn-menu" style="display:none">
                    <button data-action="clipboard">Copy to clipboard</button>
                    <button data-action="csv">Download as CSV</button>
                    <button data-action="display">Display in page</button>
                </div>
            </div>
        </div>
        <div id="extractDisplayArea"></div>
        <div id="importSelectArea"></div>
    </div>

    <!-- Search Tab -->
    <div id="tab-search" class="tab-panel">
        <div class="search-form">
            <input type="text" id="searchInput" placeholder="Search by title, username, or URL...">
            <button id="searchBtn">Search</button>
        </div>
        <div id="searchResults"></div>
    </div>

    <!-- CSV Import Tab -->
    <div id="tab-csv-import" class="tab-panel">
        <div class="csv-import-form">
            <fieldset>
                <legend>Import from Browser Password Export</legend>
                <p class="csv-description">Upload a CSV file exported from Chrome, Firefox, or Safari. The format will be auto-detected.</p>
                <label>CSV File: <input type="file" id="csvFile" accept=".csv"></label>
            </fieldset>
            <div class="button-row">
                <button id="csvImportBtn">Import CSV as Database</button>
            </div>
        </div>
        <div id="csvImportResults"></div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content modal-content-wide">
            <span class="modal-close">&times;</span>
            <h3>Entry Details</h3>
            <div id="detailBody"></div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/db-history.js"></script>
    <script src="js/components/entry-table.js"></script>
    <script src="js/components/compare.js"></script>
    <script src="js/components/transfer.js"></script>
    <script src="js/components/duplicates.js"></script>
    <script src="js/components/import.js"></script>
    <script src="js/components/csv-import.js"></script>
    <script src="js/components/search.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
